#!/bin/sh

isValidTiling() {
  if [ "$1" -gt 0 ] && [ "$2" -gt 0 ] && [ "$3" -eq 0 ]
  then
    return 0;
  elif [ "$1" -gt 0 ] && [ "$2" -eq 0 ] && [ "$3" -gt 0 ]
  then
    return 0;
  elif [ "$1" -eq 0 ] && [ "$2" -gt 0 ] && [ "$3" -gt 0 ]
  then
    return 0;
  else
    return 1;
  fi
}

rm -rf $1

./db-tools/init_min_db $1

for test in 101 102 103
do
  cd $test

  for t0 in 0 1 16 32 64 128 256
  do
    for t1 in 0 1 16 32 64 128 256
    do
      for t2 in 0 1 16 32 64 128 256
      do
        if isValidTiling $t0 $t1 $t2
        then
          cd $t0-$t1-$t2

          for gang in 1 2 4 8 16 32 64 128 256
          do
            for worker in 1 2 4 8 16 32 64 128 256 512 1024
            do
              for vector in 1
              do
                for size in 32 64 128 256 512
                do
                  for rep in `seq 1 5`
                  do
                    ./eval-min ../../$1 "test" $gang $worker $vector $(($size * 1024 * 1024))
                  done
                done
              done
            done
          done

          cd ..
        fi
      done
    done
  done
  cd ..
done

