#!/bin/bash

export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:@sqlite_lib_path@:@boost_path@/lib

echo
echo "*****************"
echo "* Configuration *"
echo "*****************"
echo

if [ -n "$KLT_GENERATOR" ]
then
  echo "User-defined KLT_GENERATOR = $KLT_GENERATOR"
else
  KLT_GENERATOR=@abs_top_srcdir@/rose-build/projects/openacc-to-opencl/compiler/looptree-to-opencl
  echo "Default KLT_GENERATOR = $KLT_GENERATOR"
fi

if [ -n "$OPENACC_INC_PATH" ]
then
  echo "User-defined OPENACC_INC_PATH = $OPENACC_INC_PATH"
else
  OPENACC_INC_PATH=@abs_top_srcdir@/libopenacc/include/
  echo "Default OPENACC_INC_PATH = $OPENACC_INC_PATH"
fi

if [ -n "$OPENCL_INC_PATH" ]
then
  echo "User-defined OPENCL_INC_PATH = $OPENCL_INC_PATH"
else
  OPENCL_INC_PATH=@opencl_inc_path@
  echo "Default OPENCL_INC_PATH = $OPENCL_INC_PATH"
fi

INC_PATHS="$OPENACC_INC_PATH $OPENCL_INC_PATH"

echo
echo "**************"
echo "* Generation *"
echo "**************"
echo

rm -rf versions.tar.gz

echo "$KLT_GENERATOR $INC_PATHS versions.db @abs_top_srcdir@/tests/109/gang-i-worker-i.lt @abs_top_srcdir@/tests/109/gang-i-worker-j.lt @abs_top_srcdir@/tests/109/gang-j-worker-i.lt @abs_top_srcdir@/tests/109/gang-j-worker-j.lt"
$KLT_GENERATOR $INC_PATHS versions.db @abs_top_srcdir@/tests/109/gang-i-worker-i.lt @abs_top_srcdir@/tests/109/gang-i-worker-j.lt @abs_top_srcdir@/tests/109/gang-j-worker-i.lt @abs_top_srcdir@/tests/109/gang-j-worker-j.lt

echo
echo "************"
echo "* Finalyse *"
echo "************"
echo

echo " Create Archive"
echo " --------------"

rm -f tunning-109.tar.gz
tar -czf tunning-109.tar.gz versions.db main-109.c host-data.c kernels.cl

echo " Clean"
echo " -----"

rm -rf versions.db version-* host-data.c kernels.cl

