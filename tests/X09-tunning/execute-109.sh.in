#!/bin/bash

export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:@sqlite_lib_path@:@abs_top_srcdir@/libopenacc/lib

echo "LD_LIBRARY_PATH=$LD_LIBRARY_PATH"

SQLITE=@sqlite_lib_path@/../bin/sqlite3

echo
echo "*************"
echo "* Execution *"
echo "*************"
echo

if [ ! -r versions.db ]
then
  echo "Cannot read experiments data-base."
  exit 3
fi

device_type=
gang_exp_min=
gang_exp_max=
worker_exp_min=
worker_exp_max=
n_exp_min=
n_exp_max=
m_exp_min=
m_exp_max=
p_exp_min=
p_exp_max=

rm -rf profiles.db

for version_id in `$SQLITE versions.db "select version_id from Versions with region_id==0 and kernel_id==0;"`
do
  echo "Execute version #$version_id"

  echo "ACC_PROFILING_DB=../profiles.db ACC_DEVICE_TYPE=$device_type ./test-109 $gang_exp_min $gang_exp_max $worker_exp_min $worker_exp_max $n_exp_min $n_exp_max $m_exp_min $m_exp_max $p_exp_min $p_exp_max $version_id &> exec-$device_type.log"
  ACC_PROFILING_DB=profiles.db ACC_DEVICE_TYPE=$device_type ./test-109 $device_type $gang_exp_min $gang_exp_max $worker_exp_min $worker_exp_max $n_exp_min $n_exp_max $m_exp_min $m_exp_max $p_exp_min $p_exp_max $version_id &> exec-$device_type.log

done

